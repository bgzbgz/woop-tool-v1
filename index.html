<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOOP Tool | Fast Track Program</title>
    <!-- Updated: no login, direct access -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        @font-face {
            font-family: 'Plaak';
            src: url('Plaak3Trial-43-Bold.otf') format('opentype');
            font-weight: bold;
        }
        
        @font-face {
            font-family: 'Riforma';
            src: url('RiformaLL-Regular.otf') format('opentype');
            font-weight: normal;
        }
        
        @font-face {
            font-family: 'Monument';
            src: url('MonumentGrotesk-Mono.otf') format('opentype');
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Riforma', -apple-system, sans-serif;
            font-size: 16px;
            color: #000000;
            background: #FFFFFF;
            -webkit-font-smoothing: antialiased;
        }
        
        .plaak {
            font-family: 'Plaak', sans-serif;
            font-weight: bold;
            letter-spacing: -0.01em;
            line-height: 1.2;
        }
        
        .monument {
            font-family: 'Monument', monospace;
            letter-spacing: 0.05em;
        }
        
        .smooth {
            transition: all 0.2s ease;
        }
        
        .worksheet-input {
            border: 1px solid #E0E0E0;
            padding: 12px 16px;
            font-family: 'Riforma', sans-serif;
            font-size: 18px;
            transition: border-color 0.2s ease;
            width: 100%;
        }
        
        .worksheet-input:focus {
            outline: none;
            border-color: #000000;
        }
        
        .worksheet-textarea {
            border: 1px solid #E0E0E0;
            padding: 12px 16px;
            font-family: 'Riforma', sans-serif;
            font-size: 18px;
            transition: border-color 0.2s ease;
            width: 100%;
            min-height: 120px;
            resize: vertical;
        }
        
        .worksheet-textarea:focus {
            outline: none;
            border-color: #000000;
        }
        
        .btn-primary {
            background: #000000;
            color: #FFFFFF;
            padding: 16px 32px;
            border: 2px solid #000000;
            font-family: 'Riforma', sans-serif;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn-primary:disabled {
            background: #E0E0E0;
            color: #9CA3AF;
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .btn-secondary {
            background: #FFFFFF;
            color: #000000;
            padding: 12px 24px;
            border: 2px solid #000000;
            font-family: 'Riforma', sans-serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-secondary:hover {
            background: #F8F8F8;
        }
        
        .numbered-section {
            background: #000000;
            color: #FFFFFF;
            padding: 10px 16px;
            font-size: 18px;
            font-weight: bold;
            letter-spacing: 0.5px;
            display: inline-block;
        }
        
        .help-button {
            position: fixed;
            top: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #000000;
            color: #FFFFFF;
            border: 2px solid #000000;
            font-size: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 40;
            transition: all 0.2s ease;
        }
        
        .help-button:hover {
            transform: scale(1.1);
            background: #fff469;
            color: #000000;
        }
        
        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #E0E0E0;
            transition: all 0.2s ease;
        }
        
        .progress-dot.active {
            background: #000000;
            transform: scale(1.3);
        }
        
        .progress-dot.completed {
            background: #000000;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-in {
            animation: slideIn 0.3s ease-out;
        }
        
        .cover-overlay {
            background: linear-gradient(to bottom, rgba(0,0,0,0.4), rgba(0,0,0,0.7));
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Configuration
        const CONFIG = {
            AUTOSAVE_WEBHOOK: 'YOUR_N8N_AUTOSAVE_WEBHOOK_URL',
            SHARE_WEBHOOK: 'YOUR_N8N_SHARE_WEBHOOK_URL',
            SUBMIT_WEBHOOK: 'YOUR_N8N_SUBMIT_WEBHOOK_URL',
            AUTOSAVE_DELAY: 2000
        };

        // Help Modal Component
        function HelpModal({ isOpen, onClose, content }) {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50">
                    <div className="bg-white max-w-3xl p-12 border-8 border-black max-h-[80vh] overflow-y-auto">
                        <div className="flex justify-between items-start mb-6">
                            <h2 className="plaak text-5xl">INSTRUCTIONS</h2>
                            <button onClick={onClose} className="text-4xl font-bold hover:text-gray-600">√ó</button>
                        </div>
                        {content}
                        <button className="btn-primary w-full text-xl py-4 mt-8" onClick={onClose}>
                            GOT IT
                        </button>
                    </div>
                </div>
            );
        }

        function WOOPTool() {
            const [step, setStep] = useState(0); // 0=cover, 0.5=intro, 1-4=steps, 999=canvas
            const [showHelp, setShowHelp] = useState(false);
            
            // Data state
            const [data, setData] = useState({
                // Step 1: Wish
                outcome: '',
                worldChange: '',
                feeling: '',
                
                // Step 2: Outcome
                steps: ['', '', '', '', ''],
                mentallyRehearsed: false,
                
                // Step 3: Obstacles
                obstacles: [{ problem: '', solution: '' }],
                
                // Step 4: Plan
                bigChunks: '',
                firstAction: '',
                deadline: ''
            });
            
            const autosaveTimer = useRef(null);
            
            // Auto-save
            useEffect(() => {
                if (autosaveTimer.current) {
                    clearTimeout(autosaveTimer.current);
                }
                
                autosaveTimer.current = setTimeout(() => {
                    localStorage.setItem('woopData', JSON.stringify({
                        data,
                        step,
                        timestamp: new Date().toISOString()
                    }));
                }, CONFIG.AUTOSAVE_DELAY);
                
                return () => {
                    if (autosaveTimer.current) {
                        clearTimeout(autosaveTimer.current);
                    }
                };
            }, [data, step]);
            
            // Load saved data
            useEffect(() => {
                const saved = localStorage.getItem('woopData');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        if (parsed.data && Array.isArray(parsed.data.obstacles)) {
                            setData(parsed.data);
                            setStep(parsed.step);
                        }
                    } catch (e) {
                        console.log('Error loading saved data:', e);
                        localStorage.removeItem('woopData');
                    }
                }
            }, []);
            
            const updateData = (field, value) => {
                setData(prev => ({ ...prev, [field]: value }));
            };
            
            const updateStep = (index, value) => {
                setData(prev => ({
                    ...prev,
                    steps: prev.steps.map((s, i) => i === index ? value : s)
                }));
            };
            
            const updateObstacle = (index, field, value) => {
                setData(prev => ({
                    ...prev,
                    obstacles: prev.obstacles.map((o, i) => 
                        i === index ? { ...o, [field]: value } : o
                    )
                }));
            };
            
            const addObstacle = () => {
                setData(prev => ({
                    ...prev,
                    obstacles: [...prev.obstacles, { problem: '', solution: '' }]
                }));
            };
            
            const removeObstacle = (index) => {
                if (data.obstacles.length > 1) {
                    setData(prev => ({
                        ...prev,
                        obstacles: prev.obstacles.filter((_, i) => i !== index)
                    }));
                }
            };
            
            // Validation
            const canProceedStep1 = data.outcome.length >= 20 && 
                                   data.worldChange.length >= 10 && 
                                   data.feeling.length >= 3;
            
            const canProceedStep2 = data.steps.filter(s => s.trim().length > 5).length >= 3 && 
                                   data.mentallyRehearsed;
            
            const canProceedStep3 = data.obstacles.length >= 1 && 
                                   data.obstacles.every(o => o.problem.trim().length > 5 && o.solution.trim().length > 5);
            
            const canProceedStep4 = data.bigChunks.length >= 10 && 
                                   data.firstAction.length >= 10 && 
                                   data.deadline !== '';
            
            // Help content
            const getHelpContent = () => {
                if (step === 1) {
                    return (
                        <div>
                            <h3 className="plaak text-3xl mb-4">WHY</h3>
                            <p className="mb-6 text-lg">Dreams create energy. Clarity of your dream creates comfort. Your brain doesn't differentiate between what's in your head and reality.</p>
                            
                            <h3 className="plaak text-3xl mb-4">WHAT</h3>
                            <p className="mb-6 text-lg">Define your end game for the Fast Track program with brutal clarity.</p>
                            
                            <h3 className="plaak text-3xl mb-4">HOW</h3>
                            <ol className="text-lg space-y-2">
                                <li>1. Picture the concrete outcome</li>
                                <li>2. Describe how the world changed</li>
                                <li>3. Feel the emotion of success</li>
                            </ol>
                        </div>
                    );
                } else if (step === 2) {
                    return (
                        <div>
                            <h3 className="plaak text-3xl mb-4">WHY</h3>
                            <p className="mb-6 text-lg">Mental rehearsal works. Lewis Hamilton mentally drives each lap before stepping in the car.</p>
                            
                            <h3 className="plaak text-3xl mb-4">WHAT</h3>
                            <p className="mb-6 text-lg">Map the journey from where you are to your end game.</p>
                            
                            <h3 className="plaak text-3xl mb-4">HOW</h3>
                            <ol className="text-lg space-y-2">
                                <li>1. List 3-5 key milestones</li>
                                <li>2. Close your eyes</li>
                                <li>3. See yourself doing each step</li>
                                <li>4. Confirm when ready</li>
                            </ol>
                        </div>
                    );
                } else if (step === 3) {
                    return (
                        <div>
                            <h3 className="plaak text-3xl mb-4">WHY</h3>
                            <p className="mb-6 text-lg">You need to be mentally prepared. When the problem comes, you'll recognize it and say "Nothing new to me."</p>
                            
                            <h3 className="plaak text-3xl mb-4">WHAT</h3>
                            <p className="mb-6 text-lg">Identify what will try to stop you, and decide now how you'll respond.</p>
                            
                            <h3 className="plaak text-3xl mb-4">HOW</h3>
                            <ol className="text-lg space-y-2">
                                <li>1. List the problems you'll face</li>
                                <li>2. For each: What will you do?</li>
                                <li>3. Visualize handling each one</li>
                            </ol>
                        </div>
                    );
                } else if (step === 4) {
                    return (
                        <div>
                            <h3 className="plaak text-3xl mb-4">WHY</h3>
                            <p className="mb-6 text-lg">Big steps are intimidating. Fast Track hates big steps. Cut the elephant into pieces.</p>
                            
                            <h3 className="plaak text-3xl mb-4">WHAT</h3>
                            <p className="mb-6 text-lg">Break down your journey and commit to the easiest first action.</p>
                            
                            <h3 className="plaak text-3xl mb-4">HOW</h3>
                            <ol className="text-lg space-y-2">
                                <li>1. List the big chunks of work</li>
                                <li>2. Pick the easiest piece</li>
                                <li>3. Set a specific deadline</li>
                                <li>4. Commit publicly</li>
                            </ol>
                        </div>
                    );
                }
                return null;
            };

            return (
                <div className="min-h-screen bg-white">
                    {/* Help Button */}
                    {step >= 1 && step <= 4 && (
                        <button className="help-button no-print" onClick={() => setShowHelp(true)}>
                            ?
                        </button>
                    )}

                    {/* Help Modal */}
                    <HelpModal isOpen={showHelp} onClose={() => setShowHelp(false)} content={getHelpContent()} />

                    {/* Cover Page */}
                    {step === 0 && (
                        <div className="relative min-h-screen flex items-center justify-center">
                            <img 
                                src="asoggetti-sXPbIgVcmW4-unsplash.jpg" 
                                alt="Fast Track" 
                                className="absolute inset-0 w-full h-full object-cover"
                            />
                            <div className="absolute inset-0 cover-overlay"></div>
                            <div className="relative z-10 text-center text-white px-8">
                                <h1 className="plaak text-9xl mb-6 animate-in">WOOP TOOL</h1>
                                <p className="text-3xl mb-12 animate-in" style={{animationDelay: '0.2s'}}>
                                    Transform your wish into an actionable plan
                                </p>
                                <button 
                                    className="bg-white text-black plaak text-3xl px-16 py-6 border-4 border-white hover:bg-black hover:text-white transition-all duration-200 animate-in"
                                    style={{animationDelay: '0.4s'}}
                                    onClick={() => setStep(0.5)}
                                >
                                    START
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Intro Screen */}
                    {step === 0.5 && (
                        <div className="bg-black text-white min-h-screen p-16">
                            <div className="max-w-5xl mx-auto">
                                <h1 className="plaak text-9xl mb-16 animate-in">BEFORE WE START</h1>
                                
                                <div className="mb-12 animate-in" style={{animationDelay: '0.1s'}}>
                                    <h2 className="plaak text-6xl mb-6">PURPOSE</h2>
                                    <p className="text-3xl leading-relaxed">
                                        WOOP helps you transform ambitious goals into concrete, actionable plans using mental contrasting and implementation intentions.
                                    </p>
                                    <p className="text-2xl text-gray-400 mt-4">
                                        Based on research by Gabriele Oettingen. Used by elite performers worldwide.
                                    </p>
                                </div>

                                <div className="mb-12 animate-in" style={{animationDelay: '0.2s'}}>
                                    <h2 className="plaak text-6xl mb-6" style={{color: '#fff469'}}>MISTAKES TO AVOID</h2>
                                    <ul className="text-2xl space-y-4">
                                        <li className="flex items-start">
                                            <span className="text-4xl mr-4">‚Ä¢</span>
                                            <span>Being vague about your outcome (specificity creates energy)</span>
                                        </li>
                                        <li className="flex items-start">
                                            <span className="text-4xl mr-4">‚Ä¢</span>
                                            <span>Skipping mental rehearsal (visualization is half the work)</span>
                                        </li>
                                        <li className="flex items-start">
                                            <span className="text-4xl mr-4">‚Ä¢</span>
                                            <span>Only thinking positive (must anticipate obstacles)</span>
                                        </li>
                                        <li className="flex items-start">
                                            <span className="text-4xl mr-4">‚Ä¢</span>
                                            <span>Choosing a big first step (smallest action wins)</span>
                                        </li>
                                        <li className="flex items-start">
                                            <span className="text-4xl mr-4">‚Ä¢</span>
                                            <span>Not committing to a deadline (date = reality)</span>
                                        </li>
                                    </ul>
                                </div>

                                <div className="mb-16 animate-in" style={{animationDelay: '0.3s'}}>
                                    <h2 className="plaak text-6xl mb-8">THE JOURNEY</h2>
                                    <div className="grid grid-cols-4 gap-8 text-center">
                                        <div className="border-2 border-white p-8">
                                            <div className="text-9xl plaak mb-4">01</div>
                                            <p className="text-2xl font-bold mb-2">WISH</p>
                                            <p className="text-xl text-gray-400">Your End Game</p>
                                        </div>
                                        <div className="border-2 border-white p-8">
                                            <div className="text-9xl plaak mb-4">02</div>
                                            <p className="text-2xl font-bold mb-2">OUTCOME</p>
                                            <p className="text-xl text-gray-400">The Steps</p>
                                        </div>
                                        <div className="border-2 border-white p-8">
                                            <div className="text-9xl plaak mb-4">03</div>
                                            <p className="text-2xl font-bold mb-2">OBSTACLE</p>
                                            <p className="text-xl text-gray-400">The Traps</p>
                                        </div>
                                        <div className="border-2 border-white p-8">
                                            <div className="text-9xl plaak mb-4">04</div>
                                            <p className="text-2xl font-bold mb-2">PLAN</p>
                                            <p className="text-xl text-gray-400">First Bite</p>
                                        </div>
                                    </div>
                                </div>

                                <button 
                                    className="btn-primary w-full text-3xl py-8 plaak animate-in" 
                                    style={{animationDelay: '0.4s'}}
                                    onClick={() => setStep(1)}
                                >
                                    LET'S START ‚Üí
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Header (for steps 1-4) */}
                    {step >= 1 && step < 5 && (
                        <>
                            <header className="border-b-2 border-black py-6 px-8 no-print">
                                <h1 className="plaak text-3xl">WOOP TOOL</h1>
                                <p className="text-sm mt-2 text-gray-600">Wish, Outcome, Obstacle, Plan</p>
                            </header>

                            {/* Progress Indicator */}
                            <div className="border-b border-gray-200 py-6 px-8 no-print">
                                <div className="flex items-center justify-between max-w-4xl">
                                    <div className="flex items-center gap-2">
                                        <div className={`progress-dot ${step >= 1 ? 'active' : ''} ${step > 1 ? 'completed' : ''}`}></div>
                                        <span className={`text-sm ${step === 1 ? 'font-bold' : ''}`}>Wish</span>
                                    </div>
                                    <div className="flex-1 h-0.5 bg-gray-200 mx-4">
                                        <div className={`h-full bg-black transition-all ${step > 1 ? 'w-full' : 'w-0'}`}></div>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <div className={`progress-dot ${step >= 2 ? 'active' : ''} ${step > 2 ? 'completed' : ''}`}></div>
                                        <span className={`text-sm ${step === 2 ? 'font-bold' : ''}`}>Outcome</span>
                                    </div>
                                    <div className="flex-1 h-0.5 bg-gray-200 mx-4">
                                        <div className={`h-full bg-black transition-all ${step > 2 ? 'w-full' : 'w-0'}`}></div>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <div className={`progress-dot ${step >= 3 ? 'active' : ''} ${step > 3 ? 'completed' : ''}`}></div>
                                        <span className={`text-sm ${step === 3 ? 'font-bold' : ''}`}>Obstacle</span>
                                    </div>
                                    <div className="flex-1 h-0.5 bg-gray-200 mx-4">
                                        <div className={`h-full bg-black transition-all ${step > 3 ? 'w-full' : 'w-0'}`}></div>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <div className={`progress-dot ${step >= 4 ? 'active' : ''}`}></div>
                                        <span className={`text-sm ${step === 4 ? 'font-bold' : ''}`}>Plan</span>
                                    </div>
                                </div>
                            </div>
                        </>
                    )}

                    {/* Step 1: Wish */}
                    {step === 1 && <Step1 
                        data={data}
                        updateData={updateData}
                        canProceed={canProceedStep1}
                        onNext={() => setStep(2)}
                    />}

                    {/* Step 2: Outcome */}
                    {step === 2 && <Step2 
                        data={data}
                        updateStep={updateStep}
                        updateData={updateData}
                        canProceed={canProceedStep2}
                        onBack={() => setStep(1)}
                        onNext={() => setStep(3)}
                    />}

                    {/* Step 3: Obstacles */}
                    {step === 3 && <Step3 
                        data={data}
                        updateObstacle={updateObstacle}
                        addObstacle={addObstacle}
                        removeObstacle={removeObstacle}
                        canProceed={canProceedStep3}
                        onBack={() => setStep(2)}
                        onNext={() => setStep(4)}
                    />}

                    {/* Step 4: Plan */}
                    {step === 4 && <Step4 
                        data={data}
                        updateData={updateData}
                        canProceed={canProceedStep4}
                        onBack={() => setStep(3)}
                        onNext={() => setStep(999)}
                    />}

                    {/* Canvas View */}
                    {step === 999 && <CanvasView 
                        data={data}
                        onBack={() => setStep(4)}
                    />}
                </div>
            );
        }

        // Step 1: Wish Component
        function Step1({ data, updateData, canProceed, onNext }) {
            return (
                <main className="p-12 max-w-6xl mx-auto">
                    <div className="animate-in">
                        <div className="numbered-section mb-8">
                            [01] YOUR WISH
                        </div>

                        <div className="bg-black text-white border-4 border-black p-6 mb-8">
                            <h3 className="plaak text-3xl mb-2">DEFINE YOUR END GAME</h3>
                            <p className="text-xl">
                                Picture your success in vivid detail. What have you achieved? How has the world changed? How do you feel?
                            </p>
                        </div>

                        <div className="space-y-8">
                            <div>
                                <label className="block font-bold mb-3 text-xl">What have you achieved? What's the concrete outcome?</label>
                                <textarea
                                    className="worksheet-textarea"
                                    value={data.outcome}
                                    onChange={(e) => updateData('outcome', e.target.value)}
                                    placeholder="It's 90 days from now. The Fast Track program is complete. Our team is aligned on 3 values. We've implemented the ABC system. Weekly metrics dashboard is live. Revenue up 15%."
                                    maxLength={300}
                                />
                                <div className="text-sm text-gray-600 mt-2">
                                    {data.outcome.length}/300 characters (min 20)
                                </div>
                            </div>

                            <div>
                                <label className="block font-bold mb-3 text-xl">How has the world changed?</label>
                                <textarea
                                    className="worksheet-textarea"
                                    value={data.worldChange}
                                    onChange={(e) => updateData('worldChange', e.target.value)}
                                    placeholder="My team makes decisions without me. Clients notice we're more responsive. I have 10 hours/week for strategy work."
                                    maxLength={200}
                                />
                                <div className="text-sm text-gray-600 mt-2">
                                    {data.worldChange.length}/200 characters (min 10)
                                </div>
                            </div>

                            <div>
                                <label className="block font-bold mb-3 text-xl">How do you feel about it?</label>
                                <input
                                    type="text"
                                    className="worksheet-input"
                                    value={data.feeling}
                                    onChange={(e) => updateData('feeling', e.target.value)}
                                    placeholder="Energized. Proud. Unstoppable. Clear. In control."
                                />
                                <div className="text-sm text-gray-600 mt-2">
                                    One word or short phrase
                                </div>
                            </div>
                        </div>

                        <div className="flex justify-end mt-12">
                            <button 
                                className="btn-primary text-xl py-4 px-8"
                                disabled={!canProceed}
                                onClick={onNext}
                            >
                                Next: Define Steps ‚Üí
                            </button>
                        </div>
                    </div>
                </main>
            );
        }

        // Step 2: Outcome Component
        function Step2({ data, updateStep, updateData, canProceed, onBack, onNext }) {
            return (
                <main className="p-12 max-w-6xl mx-auto">
                    <div className="animate-in">
                        <div className="numbered-section mb-8">
                            [02] THE OUTCOME
                        </div>

                        <div className="bg-black text-white border-4 border-black p-6 mb-8">
                            <h3 className="plaak text-3xl mb-2">MAP THE STEPS</h3>
                            <p className="text-xl">
                                What are the 3-5 key milestones to reach your end game? Then mentally rehearse each one.
                            </p>
                        </div>

                        <div className="space-y-6 mb-8">
                            {data.steps.map((step, index) => (
                                <div key={index}>
                                    <label className="block font-bold mb-2 text-lg">
                                        Step {index + 1} {index < 3 && <span className="text-red-500">*</span>}
                                    </label>
                                    <input
                                        type="text"
                                        className="worksheet-input"
                                        value={step}
                                        onChange={(e) => updateStep(index, e.target.value)}
                                        placeholder={[
                                            "Align team on core values and 3 critical moves",
                                            "Implement ABC delegation system",
                                            "Launch weekly metrics dashboard",
                                            "Optimize personal energy routines",
                                            "Build strategic planning rhythm"
                                        ][index]}
                                    />
                                </div>
                            ))}
                        </div>

                        <div className="bg-gray-50 border-4 border-black p-8 mb-8">
                            <h3 className="plaak text-2xl mb-4">MENTAL REHEARSAL</h3>
                            <p className="text-lg mb-6">
                                Close your eyes. Picture yourself completing each step above. See the details. Feel the momentum.
                            </p>
                            <p className="text-base text-gray-600 italic mb-6">
                                Lewis Hamilton mentally drives each lap before stepping in the car.
                            </p>
                            <label className="flex items-center gap-3 cursor-pointer">
                                <input
                                    type="checkbox"
                                    className="w-6 h-6"
                                    checked={data.mentallyRehearsed}
                                    onChange={(e) => updateData('mentallyRehearsed', e.target.checked)}
                                />
                                <span className="font-bold text-lg">
                                    I've mentally rehearsed each step. I can see exactly what needs to happen.
                                </span>
                            </label>
                        </div>

                        <div className="flex justify-between">
                            <button className="btn-secondary text-lg py-3 px-6" onClick={onBack}>
                                ‚Üê Back
                            </button>
                            <button 
                                className="btn-primary text-xl py-4 px-8"
                                disabled={!canProceed}
                                onClick={onNext}
                            >
                                Next: Identify Obstacles ‚Üí
                            </button>
                        </div>
                    </div>
                </main>
            );
        }

        // Step 3: Obstacles Component
        function Step3({ data, updateObstacle, addObstacle, removeObstacle, canProceed, onBack, onNext }) {
            return (
                <main className="p-12 max-w-6xl mx-auto">
                    <div className="animate-in">
                        <div className="numbered-section mb-8">
                            [03] THE OBSTACLES
                        </div>

                        <div className="bg-black text-white border-4 border-black p-6 mb-8">
                            <h3 className="plaak text-3xl mb-2">ANTICIPATE THE TRAPS</h3>
                            <p className="text-xl">
                                What will try to stop you? When these problems occur, what will you do?
                            </p>
                        </div>

                        <div className="space-y-6 mb-6">
                            {data.obstacles && Array.isArray(data.obstacles) && data.obstacles.map((obstacle, index) => (
                                <div key={index} className="border-2 border-red-500 bg-red-50 p-6">
                                    <div className="flex justify-between items-center mb-4">
                                        <span className="font-bold text-lg">Obstacle {index + 1}</span>
                                        {data.obstacles.length > 1 && (
                                            <button
                                                onClick={() => removeObstacle(index)}
                                                className="text-red-600 text-2xl font-bold hover:text-red-800"
                                            >
                                                √ó
                                            </button>
                                        )}
                                    </div>

                                    <div className="mb-4">
                                        <label className="block font-bold mb-2">What's the problem?</label>
                                        <input
                                            type="text"
                                            className="worksheet-input"
                                            value={obstacle.problem}
                                            onChange={(e) => updateObstacle(index, 'problem', e.target.value)}
                                            placeholder="Team resistance to new values. Urgent fires eating my time. My procrastination on hard conversations."
                                        />
                                    </div>

                                    <div>
                                        <label className="block font-bold mb-2">When this happens, what will you do?</label>
                                        <input
                                            type="text"
                                            className="worksheet-input"
                                            value={obstacle.solution}
                                            onChange={(e) => updateObstacle(index, 'solution', e.target.value)}
                                            placeholder="I'll schedule 1-on-1s immediately. I'll time-block 'fire hours'. I'll use the 5-second rule and just start."
                                        />
                                    </div>
                                </div>
                            ))}
                        </div>

                        {data.obstacles.length < 5 && (
                            <button
                                onClick={addObstacle}
                                className="btn-secondary w-full text-lg py-4 mb-8"
                            >
                                + Add Another Obstacle
                            </button>
                        )}

                        <div className="bg-black text-white p-6 mb-8 text-center">
                            <p className="text-xl">
                                <strong>Remember:</strong> When these show up, you'll smile and say "Nothing new to me. I'm prepared."
                            </p>
                        </div>

                        <div className="flex justify-between">
                            <button className="btn-secondary text-lg py-3 px-6" onClick={onBack}>
                                ‚Üê Back
                            </button>
                            <button 
                                className="btn-primary text-xl py-4 px-8"
                                disabled={!canProceed}
                                onClick={onNext}
                            >
                                Next: Create Plan ‚Üí
                            </button>
                        </div>
                    </div>
                </main>
            );
        }

        // Step 4: Plan Component
        function Step4({ data, updateData, canProceed, onBack, onNext }) {
            return (
                <main className="p-12 max-w-6xl mx-auto">
                    <div className="animate-in">
                        <div className="numbered-section mb-8">
                            [04] THE PLAN
                        </div>

                        <div className="bg-black text-white border-4 border-black p-6 mb-8">
                            <h3 className="plaak text-3xl mb-2">CUT THE ELEPHANT</h3>
                            <p className="text-xl">
                                Big steps are intimidating. Break them down. Choose the smallest, easiest piece to start.
                            </p>
                        </div>

                        <div className="space-y-8">
                            <div>
                                <label className="block font-bold mb-3 text-xl">What are the big chunks of work?</label>
                                <textarea
                                    className="worksheet-textarea"
                                    style={{ minHeight: '100px' }}
                                    value={data.bigChunks}
                                    onChange={(e) => updateData('bigChunks', e.target.value)}
                                    placeholder="Define and document company values&#10;Build ABC delegation framework&#10;Set up weekly metrics dashboard"
                                />
                            </div>

                            <div className="bg-green-50 border-4 border-green-500 p-6">
                                <h3 className="plaak text-2xl mb-6">THE FIRST BITE</h3>

                                <div className="mb-6">
                                    <label className="block font-bold mb-3 text-lg">
                                        Which is the smallest, easiest piece you can do first?
                                    </label>
                                    <textarea
                                        className="worksheet-textarea"
                                        value={data.firstAction}
                                        onChange={(e) => updateData('firstAction', e.target.value)}
                                        placeholder="Schedule 90-minute workshop with leadership team to brainstorm our 5 core values. Book the room. Send the invite. That's it."
                                    />
                                </div>

                                <div>
                                    <label className="block font-bold mb-3 text-lg">By when?</label>
                                    <input
                                        type="date"
                                        className="worksheet-input text-xl"
                                        value={data.deadline}
                                        onChange={(e) => updateData('deadline', e.target.value)}
                                        min={new Date().toISOString().split('T')[0]}
                                        style={{ padding: '16px' }}
                                    />
                                </div>
                            </div>
                        </div>

                        <div className="flex justify-between mt-12">
                            <button className="btn-secondary text-lg py-3 px-6" onClick={onBack}>
                                ‚Üê Back
                            </button>
                            <button 
                                className="btn-primary text-xl py-4 px-8"
                                disabled={!canProceed}
                                onClick={onNext}
                            >
                                View Your Canvas ‚Üí
                            </button>
                        </div>
                    </div>
                </main>
            );
        }

        // Canvas View Component
        function CanvasView({ data, onBack }) {
            const handleShare = () => {
                alert('‚úÖ Shared with your team! Accountability activated.');
            };

            const handleSubmit = () => {
                // Save confirmation
                alert('üéâ WOOP Plan Submitted! Your clarity and energy are locked in.');
                console.log('WOOP Data:', data);
            };

            const handleExport = async () => {
                try {
                    // Show loading state
                    const exportBtn = event.target;
                    exportBtn.disabled = true;
                    exportBtn.textContent = 'Generating PDF...';

                    // Check if libraries are loaded
                    if (!window.jspdf || !window.html2canvas) {
                        alert('PDF libraries are still loading. Please wait a moment and try again.');
                        exportBtn.disabled = false;
                        exportBtn.textContent = 'Export PDF';
                        return;
                    }

                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4'
                    });

                    // PAGE 1: Cover Image
                    const coverImg = new Image();
                    coverImg.src = 'asoggetti-sXPbIgVcmW4-unsplash.jpg';
                    
                    await new Promise((resolve, reject) => {
                        coverImg.onload = () => {
                            try {
                                // Add cover image to fill entire first page
                                const imgWidth = 210; // A4 width in mm
                                const imgHeight = 297; // A4 height in mm
                                pdf.addImage(coverImg, 'JPEG', 0, 0, imgWidth, imgHeight);
                                
                                // Add "YOUR WOOP CANVAS" text overlay
                                pdf.setFontSize(32);
                                pdf.setTextColor(255, 255, 255);
                                pdf.text('YOUR WOOP CANVAS', 105, 280, { align: 'center' });
                                
                                resolve();
                            } catch (err) {
                                reject(err);
                            }
                        };
                        coverImg.onerror = () => reject(new Error('Cover image failed to load'));
                    });

                    // PAGE 2: Canvas Content
                    pdf.addPage();
                    
                    // Capture the canvas content
                    const canvasElement = document.querySelector('.max-w-6xl .border-4');
                    if (!canvasElement) {
                        throw new Error('Canvas element not found');
                    }

                    const canvas = await html2canvas(canvasElement, {
                        scale: 2,
                        backgroundColor: '#ffffff',
                        logging: false
                    });

                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = 190; // Slightly less than A4 width for margins
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    
                    // Add canvas content with margins
                    pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);

                    // Save the PDF
                    const today = new Date().toISOString().split('T')[0];
                    pdf.save(`WOOP-Canvas-${today}.pdf`);

                    // Reset button
                    exportBtn.disabled = false;
                    exportBtn.textContent = 'Export PDF';
                } catch (error) {
                    console.error('PDF Export Error:', error);
                    alert('Failed to generate PDF: ' + error.message);
                    // Reset button
                    event.target.disabled = false;
                    event.target.textContent = 'Export PDF';
                }
            };

            return (
                <div className="min-h-screen bg-white">
                    {/* Header */}
                    <header className="no-print border-b-4 border-black p-6">
                        <div className="max-w-6xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 className="plaak text-4xl mb-2">YOUR WOOP CANVAS</h1>
                                <p className="text-gray-600">Clarity + Energy = Action</p>
                            </div>
                            <button onClick={onBack} className="btn-secondary">
                                ‚Üê Edit
                            </button>
                        </div>
                    </header>

                    {/* Canvas */}
                    <div className="max-w-6xl mx-auto p-12">
                        <div className="border-4 border-black p-8 mb-8">
                            {/* Wish Section */}
                            <div className="mb-12">
                                <div className="numbered-section mb-4">[W] YOUR WISH</div>
                                <div className="bg-green-50 border-l-4 border-green-500 p-6">
                                    <h3 className="plaak text-xl mb-2">ACHIEVED</h3>
                                    <p className="mb-4">{data.outcome}</p>

                                    <h3 className="plaak text-xl mb-2">WORLD CHANGED</h3>
                                    <p className="mb-4">{data.worldChange}</p>

                                    <h3 className="plaak text-xl mb-2">FEELING</h3>
                                    <p className="text-2xl font-bold">{data.feeling}</p>
                                </div>
                            </div>

                            {/* Outcomes Section */}
                            <div className="mb-12">
                                <div className="numbered-section mb-4">[O] THE OUTCOME</div>
                                <div className="grid grid-cols-2 gap-4">
                                    {data.steps && Array.isArray(data.steps) && data.steps.filter(s => s.trim()).map((step, index) => (
                                        <div key={index} className="border-2 border-black p-4">
                                            <div className="monument text-xs mb-2">STEP {index + 1}</div>
                                            <p>{step}</p>
                                        </div>
                                    ))}
                                </div>
                                {data.mentallyRehearsed && (
                                    <div className="bg-black text-white p-2 mt-4 text-center monument text-sm">
                                        ‚úì MENTALLY REHEARSED
                                    </div>
                                )}
                            </div>

                            {/* Obstacles Section */}
                            <div className="mb-12">
                                <div className="numbered-section mb-4">[O] THE OBSTACLES</div>
                                {data.obstacles && Array.isArray(data.obstacles) && data.obstacles.map((obstacle, index) => (
                                    <div key={index} className="bg-red-50 border-l-4 border-red-500 p-4 mb-3">
                                        <div className="font-bold mb-2">
                                            Problem: {obstacle.problem}
                                        </div>
                                        <div className="text-sm">
                                            <strong>Solution:</strong> {obstacle.solution}
                                        </div>
                                    </div>
                                ))}
                            </div>

                            {/* Plan Section */}
                            <div>
                                <div className="numbered-section mb-4">[P] THE PLAN</div>
                                <div className="bg-green-50 border-4 border-green-500 p-6">
                                    <div className="bg-green-500 text-white px-4 py-2 inline-block mb-4 font-bold">
                                        FIRST ACTION
                                    </div>
                                    <p className="text-xl mb-4">{data.firstAction}</p>
                                    <div className="flex items-center gap-4">
                                        <span className="monument text-sm">DEADLINE:</span>
                                        <span className="text-2xl font-bold">
                                            {new Date(data.deadline).toLocaleDateString('en-US', {
                                                month: 'short',
                                                day: 'numeric',
                                                year: 'numeric'
                                            })}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Action Buttons */}
                        <div className="flex gap-4 no-print">
                            <button onClick={handleShare} className="btn-primary flex-1 text-lg py-4">
                                Share With Team
                            </button>
                            <button onClick={handleExport} className="btn-secondary flex-1 text-lg py-4">
                                Export PDF
                            </button>
                            <button 
                                onClick={handleSubmit} 
                                className="btn-primary flex-1 text-lg py-4"
                            >
                                Final Submit
                            </button>
                        </div>

                        <div className="mt-6 text-center text-sm text-gray-600">
                            <p className="monument">CLARITY AND ENERGY LOCKED IN</p>
                        </div>
                    </div>
                </div>
            );
        }

        // Render App
        ReactDOM.render(<WOOPTool />, document.getElementById('root'));
    </script>
</body>
</html>
